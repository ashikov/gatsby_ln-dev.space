---
title: "Защита бекапов от Crypto-ransomware"
date: "2019-07-31"
draft: false
path: "/blog/31-07-2019-сrypto-ransomware-backup-protection"
---

[Crypto-ransomware](https://en.wikipedia.org/wiki/CryptoLocker) или по простому вирус-шифровальщик знаком любому IT-специалисту. Поэтому останавливаться на том, как работают такого рода программы я не вижу смысла. А вот как защитить резервные копии в том случае, если для их хранения используется Samba или FTP-сервер будет рассказано ниже.

Для защиты файлов мы будем использовать __chattr__.

Википедия говорит примерно следующее:

>__chattr__ — изменяет атрибуты файлов в файловых системах ext2fs, ext3, ext4 и частично на других файловых системах Linux

Полный список всех атрибутов с которыми работает __chattr__ можно посмотреть в той же [википедии](https://ru.wikipedia.org/wiki/Chattr) или в __man chattr__ из консоли. Кому что больше нравится.

В данный момент нас интересует только один атрибут - i (__i__mmutable). Он защищает файлы от изменения и удаления, и даже root не может ничего сделать с файлом предварительно не сняв этот атрибут.

Достаточно добавить в [cron](https://ru.wikipedia.org/wiki/Cron) задачу, которая периодически будет выполнять всего одну команду для каталога в котором лежат бекапы.

```shell
root@dev:~/backups$ chattr +i *
```

После этого файлы в данном каталоге становятся readonly.

```shell
root@dev:~/backups$ lsattr file
-------------e-- file
root@dev:~/backups$ chattr +i file
root@dev:~/backups$ lsattr file
----i--------e-- file
root@dev:~/backups$ rm -f file
rm: cannot remove 'file': Operation not permitted
```

Очищать каталоги с резервными копиями нужно предварительно сняв атрибут i противоположной командой.

```shell
root@dev:~/backups$ chattr -i *
```

На этом в общем-то все. Не забывайте о защите резервных копий и о том, что если у вас нет копии бекапа, то у вас нет бекапа. :)
